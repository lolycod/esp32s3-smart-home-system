# MaixCAM视觉检测系统实施计划

**项目名称**: MaixCAM图像与识别结果网页端呈现系统
**文档版本**: v1.0
**创建日期**: 2025-12-12
**目标**: 在网页端实时显示MaixCAM拍摄的图像、识别结果（人/火）和识别精度

---

## 📋 目录

1. [系统架构设计](#系统架构设计)
2. [核心决策说明](#核心决策说明)
3. [实施步骤概览](#实施步骤概览)
4. [详细实施计划](#详细实施计划)
5. [可能存在的问题](#可能存在的问题)
6. [建议和注意事项](#建议和注意事项)
7. [技术原理讲解](#技术原理讲解)
8. [验收标准](#验收标准)
9. [FAQ常见问题](#faq常见问题)

---

## 1. 系统架构设计

### 1.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                      系统整体架构（WiFi直连方案）                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐                       ┌──────────────┐        │
│  │  MaixCAM    │  ① HTTP MJPEG流        │              │        │
│  │192.168.31.43│────────────────────→│              │        │
│  │             │   (视频图像)           │              │        │
│  │  - 摄像头    │                       │  Web Server  │        │
│  │  - YOLOv5   │  ② WebSocket          │   Node.js    │        │
│  │  - 显示屏    │───────────────────→│   (8080端口)  │        │
│  └─────────────┘   (检测结果JSON)      │              │        │
│                                       │              │        │
│  ┌─────────────┐                       │              │        │
│  │   ESP32     │  ③ WebSocket          │              │        │
│  │192.168.x.x  │───────────────────→│              │        │
│  │             │   (传感器数据)         │              │        │
│  │  - 传感器    │                       └──────────────┘        │
│  │  - 设备控制  │                              │                │
│  └─────────────┘                              ▼                │
│                                       ┌──────────────┐         │
│                                       │   浏览器      │         │
│                                       │              │         │
│                                       │  - 视频显示   │         │
│                                       │  - 检测框叠加 │         │
│                                       │  - 数据面板   │         │
│                                       └──────────────┘         │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 数据流向说明

**① MaixCAM → Web Server (MJPEG图像流)**
- 协议: HTTP
- 端口: 8000
- 格式: MJPEG (Motion JPEG)
- 内容: 实时视频帧（已绘制检测框）
- 刷新率: 10-20 FPS（取决于模型性能）

**② MaixCAM → Web Server (检测结果)**
- 协议: WebSocket
- 端口: 8080
- 格式: JSON
- 内容: 检测对象的坐标、类别、置信度
- 发送频率: 10 Hz (每100ms一次)

**③ ESP32 → Web Server (传感器数据)**
- 协议: WebSocket
- 端口: 8080
- 格式: JSON
- 内容: 温湿度、烟雾、光照强度
- 发送频率: 0.2 Hz (每5秒一次)

### 1.3 关键组件

| 组件 | 角色 | 技术栈 | 功能 |
|------|------|--------|------|
| MaixCAM | 视觉处理终端 | Python (MaixPy) | YOLOv5检测、MJPEG推流、WebSocket发送 |
| ESP32 | 传感器控制终端 | C (ESP-IDF) | 传感器采集、设备控制、WebSocket发送 |
| Web Server | 数据中转服务器 | Node.js + Express + ws | MJPEG代理、WebSocket中继、HTTP服务 |
| Web Frontend | 用户交互界面 | HTML + CSS + JavaScript | 视频显示、数据可视化、用户操作 |

---

## 2. 核心决策说明

### 2.1 为什么选择WiFi直连而不是串口中转？

**对比分析：**

| 方案 | 优点 | 缺点 |
|------|------|------|
| 串口方案 (MaixCAM → UART → ESP32 → WiFi) | 统一由ESP32管理 | UART带宽不足(115200bps)，无法传输图像 |
| WiFi直连 (MaixCAM → WiFi → Server) | 带宽充足(54Mbps+)，低延迟，无需接线 | MaixCAM和ESP32数据分开管理 |

**最终决策：WiFi直连**

**理由：**
1. ✅ MaixCAM已连接WiFi（IP: 192.168.31.43）
2. ✅ 不需要UART接线，避免ESP32 GPIO占用冲突
3. ✅ WiFi带宽充足，可传输高质量视频流
4. ✅ 实现简单，降低系统复杂度
5. ✅ 延迟更低（减少一层数据转发）

### 2.2 为什么选择MJPEG而不是其他视频格式？

**对比分析：**

| 格式 | 优点 | 缺点 | 复杂度 |
|------|------|------|--------|
| MJPEG | 简单，浏览器原生支持，低延迟 | 带宽占用较大 | 低 |
| H.264 | 压缩率高，带宽占用小 | 需要编解码，延迟高 | 高 |
| WebRTC | 低延迟，双向通信 | 实现复杂，调试困难 | 很高 |

**最终决策：MJPEG**

**理由：**
1. ✅ HTML `<img>` 标签直接支持，无需额外库
2. ✅ MaixPy官方提供MJPEG推流功能
3. ✅ 延迟低（约100-200ms）
4. ✅ 局域网带宽充足，不担心流量问题

### 2.3 ESP32 GPIO占用情况

**已占用GPIO清单：**
- GPIO4: DHT11温湿度传感器
- GPIO5: MQ-2烟雾传感器(TTL)
- GPIO6: MQ-2烟雾传感器(ADC)
- GPIO7: 光敏电阻(AO)
- GPIO8: 光敏电阻(DO)
- GPIO11/12/13: 外接RGB灯(R/G/B)
- GPIO38: 舵机信号线

**可用UART GPIO（备用）：**
- GPIO17/18: UART1 (推荐，如未来需要串口通信)
- GPIO43/44: UART0 (调试用，不推荐占用)

**结论：** WiFi直连方案不占用任何GPIO，保留未来扩展性。

---

## 3. 实施步骤概览

### 阶段划分与时间估算

| 阶段 | 任务 | 预计时间 | 难度 |
|------|------|---------|------|
| Phase 1 | MaixCAM端修改 | 1小时 | ⭐⭐ |
| Phase 2 | Web Server端修改 | 1小时 | ⭐⭐⭐ |
| Phase 3 | Web前端修改 | 2小时 | ⭐⭐⭐⭐ |
| Phase 4 | 集成测试 | 1小时 | ⭐⭐ |
| Phase 5 | 优化调试 | 1-2小时 | ⭐⭐⭐ |
| **总计** | - | **6-8小时** | - |

### 依赖关系

```
Phase 1 (MaixCAM) 和 Phase 2 (Web Server) 可并行开发
         ↓                    ↓
         └────────┬───────────┘
                  ↓
           Phase 3 (前端)
                  ↓
           Phase 4 (测试)
                  ↓
           Phase 5 (优化)
```

---

## 4. 详细实施计划

### Phase 1: MaixCAM端修改

**目标：** 让MaixCAM能够推流MJPEG视频并通过WebSocket发送检测结果

**需要修改的文件：**
- `maixcam/main.py`

**功能清单：**
1. ✅ 初始化YOLOv5检测器（已有）
2. ✅ 初始化摄像头和显示屏（已有）
3. 🆕 启动HTTP MJPEG推流服务器（端口8000）
4. 🆕 建立WebSocket连接到Web Server（端口8080）
5. 🆕 实时发送检测结果JSON（每100ms）
6. ✅ 在图像上绘制检测框和标签（已有）

**配置参数：**
- `WEB_SERVER_IP`: Web Server的IP地址（需要用户填写）
- `WEB_SERVER_PORT`: 8080（WebSocket端口）
- `MJPEG_PORT`: 8000（视频流端口）
- `SEND_INTERVAL`: 0.1秒（检测结果发送间隔）

**数据格式（WebSocket发送）：**
```json
{
  "type": "ai_detection",
  "timestamp": 1234567890123,
  "data": {
    "detections": [
      {
        "x": 100,
        "y": 150,
        "w": 200,
        "h": 300,
        "class_id": 0,
        "class_name": "human",
        "score": 0.95
      }
    ],
    "frame_width": 320,
    "frame_height": 224
  }
}
```

**注意事项：**
1. MaixCAM必须与Web Server在同一局域网
2. 确保WiFi连接稳定
3. 检查防火墙是否阻止8080端口

---

### Phase 2: Web Server端修改

**目标：** 接收MaixCAM数据并转发给浏览器

**需要修改的文件：**
- `web/server/server.js`

**功能清单：**
1. 🆕 添加MJPEG代理路由 `/maixcam_stream`
2. 🆕 扩展WebSocket消息处理，识别`ai_detection`类型
3. 🆕 广播AI检测数据给所有浏览器客户端
4. ✅ 保持原有传感器数据处理逻辑

**需要安装的npm包：**
```bash
npm install ws request
```

**新增路由：**
- `GET /maixcam_stream` - MJPEG视频流代理

**WebSocket消息类型：**
- `ai_detection` - AI检测结果（来自MaixCAM）
- `message` - 传感器数据（来自ESP32，已有）
- `control` - 控制命令（来自浏览器，已有）

**注意事项：**
1. 确保`request`库正确安装
2. 在`server.js`中配置正确的MaixCAM IP地址
3. 测试MJPEG代理是否正常工作

---

### Phase 3: Web前端修改

**目标：** 创建视觉检测页面，显示视频流和检测结果

**需要修改的文件：**
- `web/client/index.html`

**功能清单：**
1. 🆕 添加"视觉检测"模式按钮
2. 🆕 创建视觉检测页面UI布局
3. 🆕 显示MJPEG视频流
4. 🆕 显示人类/火焰检测统计卡片
5. 🆕 显示检测日志
6. 🆕 实现WebSocket接收AI检测数据
7. 🆕 更新UI显示检测结果

**UI布局：**
```
┌─────────────────────────────────────┐
│        🎥 MaixCAM 视觉检测系统       │
├─────────────────────────────────────┤
│                                     │
│     ┌─────────────────────┐         │
│     │   MJPEG视频显示区    │         │
│     │   (实时画面+检测框)  │         │
│     └─────────────────────┘         │
│                                     │
│  ┌──────────┐    ┌──────────┐      │
│  │ 👤 人类   │    │ 🔥 火焰   │      │
│  │ 数量: 2  │    │ 数量: 0  │      │
│  │ 置信度   │    │ 置信度   │      │
│  └──────────┘    └──────────┘      │
│                                     │
│  ┌─────────────────────────┐       │
│  │   📊 检测日志            │       │
│  │   [12:34:56] 检测到2人   │       │
│  └─────────────────────────┘       │
└─────────────────────────────────────┘
```

**关键JavaScript函数：**
- `switchToVisionMode()` - 切换到视觉检测模式
- `setupVisionMode()` - 初始化视觉检测页面
- `handleAIDetection(data)` - 处理AI检测数据
- `visionLog(message)` - 记录检测日志
- `clearVisionLog()` - 清空日志

**注意事项：**
1. 确保视频流URL正确：`/maixcam_stream`
2. WebSocket连接复用现有的`sharedWs`
3. 处理视频流加载失败的情况
4. 优化UI响应速度

---

### Phase 4: 集成测试

**目标：** 验证整个系统端到端运行正常

**测试清单：**

**4.1 MaixCAM测试**
- [ ] MaixCAM程序启动成功
- [ ] MJPEG服务器启动（端口8000）
- [ ] WebSocket连接成功到Web Server
- [ ] 终端输出"📤 发送检测结果"

**4.2 Web Server测试**
- [ ] Node.js服务器启动成功
- [ ] WebSocket服务器监听8080端口
- [ ] HTTP服务器监听3000端口
- [ ] MJPEG代理路由响应正常

**4.3 浏览器测试**
- [ ] 访问 `http://localhost:3000` 成功
- [ ] 点击"视觉检测"按钮切换成功
- [ ] 视频流显示正常（无黑屏）
- [ ] 检测框和标签叠加显示
- [ ] 人类/火焰统计实时更新
- [ ] 检测日志实时滚动

**4.4 性能测试**
- [ ] 视频流延迟 < 500ms
- [ ] 检测数据延迟 < 200ms
- [ ] 浏览器CPU占用 < 30%
- [ ] 网络带宽占用 < 5 Mbps

**测试工具：**
- 浏览器开发者工具（F12）
- 网络抓包（Wireshark，可选）
- 性能监控（Chrome Performance）

---

### Phase 5: 优化调试

**目标：** 解决性能问题，提升用户体验

**优化方向：**

**5.1 性能优化**
- 降低MJPEG帧率（如果卡顿）
- 调整检测结果发送频率
- 压缩JSON数据（去除冗余字段）
- 使用WebSocket二进制传输（高级）

**5.2 用户体验优化**
- 添加加载动画
- 添加连接状态指示灯
- 添加错误提示和重连机制
- 添加检测音效（可选）

**5.3 异常处理**
- WebSocket断线重连
- MJPEG流中断恢复
- 网络波动缓冲
- 错误日志记录

**5.4 功能扩展（可选）**
- 录制功能（保存视频和检测结果）
- 截图功能
- 检测区域设置（ROI）
- 告警阈值设置

---

## 5. 可能存在的问题

### 5.1 网络相关问题

**问题1：MaixCAM无法连接到Web Server**

**现象：**
- MaixCAM终端显示"❌ 连接失败"
- Web Server没有收到连接

**可能原因：**
1. Web Server IP地址配置错误
2. 防火墙阻止8080端口
3. MaixCAM和电脑不在同一网络

**解决方案：**
1. 检查`WEB_SERVER_IP`配置
2. 关闭防火墙或添加8080端口例外
3. 确保MaixCAM和电脑连接同一WiFi

---

**问题2：浏览器无法显示视频流**

**现象：**
- 视频区域显示黑屏或加载失败
- 浏览器控制台显示404错误

**可能原因：**
1. MJPEG代理路由未正确添加
2. MaixCAM的MJPEG服务器未启动
3. 跨域问题

**解决方案：**
1. 检查`server.js`中的`/maixcam_stream`路由
2. 直接访问`http://192.168.31.43:8000`测试MaixCAM
3. 确保通过Node.js代理访问，不要直接访问MaixCAM

---

**问题3：网络延迟高**

**现象：**
- 视频流卡顿
- 检测结果延迟显示

**可能原因：**
1. WiFi信号弱
2. 网络拥塞
3. MaixCAM性能不足

**解决方案：**
1. 移近WiFi路由器
2. 降低视频分辨率或帧率
3. 减少检测结果发送频率

---

### 5.2 MaixCAM相关问题

**问题4：MaixCAM检测性能低**

**现象：**
- 帧率低于5 FPS
- 视频流不流畅

**可能原因：**
1. 模型过大或复杂
2. 输入分辨率过高
3. CPU占用过高

**解决方案：**
1. 使用YOLOv5s（最轻量级版本）
2. 降低输入分辨率（推荐224x224）
3. 减少绘制操作（不在本地显示屏绘制）

---

**问题5：WebSocket握手失败**

**现象：**
- MaixCAM显示"❌ WebSocket握手失败"
- 101状态码未返回

**可能原因：**
1. Web Server未正确处理WebSocket升级
2. 握手请求格式错误
3. 端口被占用

**解决方案：**
1. 检查Web Server的WebSocket库配置
2. 使用标准WebSocket客户端库（如`websocket-client`）
3. 检查8080端口占用（`netstat -ano | findstr 8080`）

---

### 5.3 浏览器相关问题

**问题6：检测数据不更新**

**现象：**
- 视频流正常，但统计卡片不更新
- 日志无输出

**可能原因：**
1. WebSocket消息未正确接收
2. 消息类型判断错误
3. UI更新函数未调用

**解决方案：**
1. 打开浏览器控制台查看消息日志
2. 检查`message.type === 'ai_detection'`条件
3. 检查`handleAIDetection()`函数是否执行

---

**问题7：CORS跨域错误**

**现象：**
- 浏览器控制台显示"CORS policy blocked"
- 无法访问MaixCAM资源

**可能原因：**
- 直接访问MaixCAM IP而不是通过代理

**解决方案：**
- 始终通过`/maixcam_stream`访问，不要直接访问`http://192.168.31.43:8000`

---

### 5.4 数据同步问题

**问题8：视频和检测框不同步**

**现象：**
- 检测框位置滞后或抖动
- 标签和实际物体不对应

**可能原因：**
1. 网络延迟不一致
2. 视频流和数据流传输速度不同
3. 时间戳未对齐

**解决方案：**
1. 在MaixCAM端直接绘制检测框（推荐）
2. 添加时间戳对齐机制
3. 使用缓冲队列匹配视频帧和检测数据

---

## 6. 建议和注意事项

### 6.1 开发建议

**建议1：分阶段实施，逐步验证**
- 不要一次性修改所有文件
- 每完成一个阶段就测试一次
- 确保上一阶段正常再进入下一阶段

**建议2：保留备份文件**
```
maixcam/main.py.backup
web/server/server.js.backup
web/client/index.html.backup
```

**建议3：使用版本控制**
- 每次修改前提交Git
- 出问题可以快速回退
- 记录修改历史

**建议4：详细日志记录**
- MaixCAM端打印详细日志
- Web Server端记录所有消息
- 浏览器控制台保持打开

---

### 6.2 性能建议

**建议5：合理配置参数**

**MaixCAM端：**
- 检测置信度阈值：0.5（平衡准确率和召回率）
- 发送间隔：100ms（10 Hz）
- MJPEG质量：80%（平衡画质和带宽）

**Web Server端：**
- WebSocket消息大小限制：10 MB
- 连接超时时间：30秒

**浏览器端：**
- 图像缓存：禁用（实时流）
- 日志最大条数：100条（避免内存溢出）

---

**建议6：网络优化**
- 使用5GHz WiFi（如果支持）
- 减少同一网络的其他设备
- 路由器开启QoS优先级

---

### 6.3 安全建议

**建议7：生产环境需要加固**
- 添加WebSocket认证（Token）
- 使用WSS（WebSocket Secure）
- 限制访问IP白名单
- 加密敏感数据

**注意：** 当前方案仅适用于局域网测试环境！

---

### 6.4 扩展性建议

**建议8：预留扩展接口**
- 消息类型使用枚举
- 数据结构使用可扩展格式（JSON）
- 保留未来添加新检测类别的能力
- 考虑多摄像头支持

---

## 7. 技术原理讲解

### 7.1 MJPEG流原理

**什么是MJPEG？**
- MJPEG = Motion JPEG = 运动JPEG
- 本质：连续发送JPEG图片，浏览器连续显示，形成视频

**类比理解：**
- 就像翻书动画（Flipbook）
- 每一页是一张图片（JPEG）
- 快速翻动形成动画效果

**数据格式：**
```
--frame
Content-Type: image/jpeg
Content-Length: 12345

[JPEG二进制数据]
--frame
Content-Type: image/jpeg
Content-Length: 12346

[JPEG二进制数据]
--frame
...
```

**优点：**
- ✅ 简单：HTML `<img>` 标签直接支持
- ✅ 兼容性好：所有浏览器支持
- ✅ 低延迟：无需复杂编解码
- ✅ 易调试：每帧独立，可直接查看

**缺点：**
- ❌ 带宽占用大：无帧间压缩
- ❌ 压缩率低：相比H.264高3-5倍

**为什么局域网选择MJPEG？**
- 局域网带宽充足（100Mbps+）
- 延迟更重要（<200ms）
- 实现简单，调试方便

---

### 7.2 WebSocket原理

**什么是WebSocket？**
- 浏览器和服务器之间的全双工通信协议
- 基于TCP，端口通常是80或443
- 持久连接，双方可随时发送消息

**与HTTP的区别：**

| 特性 | HTTP | WebSocket |
|------|------|-----------|
| 连接方式 | 短连接（一问一答） | 长连接（持久） |
| 数据流向 | 单向（客户端请求） | 双向（双方主动） |
| 延迟 | 高（每次都需建立连接） | 低（复用连接） |
| 开销 | 大（每次携带完整头部） | 小（最小2字节） |

**握手过程：**
```
客户端 → 服务器: HTTP Upgrade请求
服务器 → 客户端: 101 Switching Protocols
         ↓
    建立WebSocket连接
```

**消息格式：**
```
[FIN][RSV][Opcode][Mask][Payload Length][Masking Key][Payload Data]
```

**为什么使用WebSocket传输检测结果？**
- 实时性强（延迟<50ms）
- 双向通信（可发送控制命令）
- 开销小（适合高频小数据）

---

### 7.3 Node.js代理原理

**什么是代理（Proxy）？**
- 中间服务器，转发客户端和目标服务器的请求

**为什么需要代理？**
- 浏览器的**同源策略**（Same-Origin Policy）限制

**同源策略：**
- 浏览器安全机制
- 禁止网页访问不同域名、端口或协议的资源
- 例如：`http://localhost:3000` 无法直接访问 `http://192.168.31.43:8000`

**代理工作流程：**
```
浏览器 → Node.js代理 → MaixCAM
(同域)      (转发)       (目标)
```

**实现方式：**
- 使用`request`库管道转发
- 保持原始数据格式
- 透明代理（无修改）

**优点：**
- ✅ 解决跨域问题
- ✅ 统一数据入口
- ✅ 可添加缓存、日志等中间件

---

### 7.4 MaixCAM YOLOv5检测流程

**YOLOv5检测流程：**
```
1. 读取摄像头图像
2. 预处理（缩放、归一化）
3. 推理（神经网络前向传播）
4. 后处理（NMS非极大值抑制）
5. 输出检测框和置信度
```

**模型性能参数：**
- 输入分辨率：320x224 或 224x224
- 模型大小：约7MB（model_243027.cvimodel）
- 检测类别：2类（human, fire）
- 预计FPS：10-20 FPS

**置信度阈值：**
- `conf_th = 0.5` - 低于50%的检测结果丢弃
- `iou_th = 0.45` - NMS重叠阈值

---

## 8. 验收标准

### 8.1 功能验收

**基本功能（必须）：**
- [ ] 网页端能实时显示MaixCAM视频流
- [ ] 视频流中能看到检测框和标签
- [ ] 人类检测数量实时更新
- [ ] 火焰检测数量实时更新
- [ ] 置信度显示准确
- [ ] 检测日志实时滚动

**扩展功能（可选）：**
- [ ] 视频流延迟 < 500ms
- [ ] 检测框颜色区分（人类蓝色，火焰红色）
- [ ] 音效提示（检测到火焰）
- [ ] 录制功能
- [ ] 截图功能

---

### 8.2 性能验收

**网络性能：**
- [ ] MJPEG流帧率 ≥ 10 FPS
- [ ] WebSocket延迟 < 200ms
- [ ] 带宽占用 < 5 Mbps

**系统性能：**
- [ ] 浏览器CPU占用 < 30%
- [ ] 浏览器内存占用 < 200MB
- [ ] MaixCAM CPU占用 < 80%

**稳定性：**
- [ ] 连续运行30分钟无崩溃
- [ ] 网络波动自动重连
- [ ] 无内存泄漏

---

### 8.3 用户体验验收

**易用性：**
- [ ] 一键切换到视觉检测模式
- [ ] 视频流自动加载
- [ ] 连接状态清晰提示
- [ ] 错误信息友好显示

**美观性：**
- [ ] UI风格统一（赛博朋克风格）
- [ ] 动画流畅（过渡效果）
- [ ] 响应式布局（适配不同屏幕）

---

## 9. FAQ常见问题

### Q1: MaixCAM一定要通过串口传数据给ESP32吗？
**A:** 不一定！既然MaixCAM已经连接WiFi，推荐使用WiFi直连方案，避免UART带宽限制和接线麻烦。

---

### Q2: MJPEG流的带宽占用有多大？
**A:** 根据分辨率和质量：
- 320x224, 80%质量：约2-3 Mbps
- 224x224, 80%质量：约1-2 Mbps

局域网100Mbps+带宽完全够用。

---

### Q3: 为什么不直接在浏览器端绘制检测框？
**A:** 可以，但有以下问题：
- 需要视频帧和检测数据时间同步
- Canvas绘制增加浏览器CPU负担
- 实现复杂，调试困难

推荐在MaixCAM端直接绘制，随视频流传输。

---

### Q4: ESP32不连接MaixCAM会影响功能吗？
**A:** 不影响！ESP32和MaixCAM独立工作：
- ESP32负责传感器数据和设备控制
- MaixCAM负责视觉检测
- 两者数据都汇总到Web Server

---

### Q5: 如何提高检测帧率？
**A:** 优化方向：
1. 降低输入分辨率（224x224 → 160x160）
2. 使用更轻量的模型（YOLOv5n）
3. 减少绘制操作
4. 降低置信度阈值（减少后处理时间）

---

### Q6: 能否录制视频和检测结果？
**A:** 可以！实现方式：
- MJPEG流保存为视频文件
- 检测结果保存为JSON
- 使用FFmpeg转换格式

---

### Q7: 如何部署到公网访问？
**A:** 需要额外配置：
1. 申请域名和SSL证书
2. 配置端口转发或内网穿透
3. 使用HTTPS和WSS
4. 添加用户认证

**注意：** 当前方案仅适用局域网！

---

## 10. 附录

### 10.1 参考文档

**MaixCAM官方文档：**
- [MaixCAM JPEG推流](https://wiki.sipeed.com/maixpy/doc/zh/video/jpeg_streaming.html)
- [MaixCAM UART通信](https://wiki.sipeed.com/maixpy/doc/zh/peripheral/uart.html)
- [Maix通信协议](https://wiki.sipeed.com/maixpy/doc/zh/comm/maix_protocol.html)

**ESP32官方文档：**
- [ESP32 UART编程指南](https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/peripherals/uart.html)

**相关开源项目：**
- [MaixCAM智能小车](https://github.com/Ruqiu2415/Maixcam_2025)
- [go2rtc - 通用视频流服务](https://github.com/AlexxIT/go2rtc)

---

### 10.2 关键文件清单

**需要修改的文件：**
1. `maixcam/main.py` - MaixCAM主程序
2. `web/server/server.js` - Web服务器
3. `web/client/index.html` - 前端页面

**需要新增的文件：**
- 无（所有功能在现有文件中添加）

**配置文件：**
- `maixcam/main.py` 第8行：`WEB_SERVER_IP`
- `web/server/server.js`：MaixCAM IP地址

---

### 10.3 命令速查表

**MaixCAM操作：**
```bash
# 上传文件到MaixCAM
scp main.py root@192.168.31.43:/root/

# SSH连接MaixCAM
ssh root@192.168.31.43

# 运行程序
python3 main.py
```

**Web Server操作：**
```bash
# 进入web目录
cd web

# 安装依赖
npm install ws request

# 启动服务器
node server/server.js
```

**浏览器操作：**
```
访问地址：http://localhost:3000
打开控制台：F12
刷新页面：Ctrl+F5（强制刷新）
```

---

### 10.4 故障排查流程图

```
视频流不显示？
     ↓
[1] 检查MaixCAM是否运行
     ├─ 否 → 启动MaixCAM程序
     └─ 是 → 下一步
     ↓
[2] 直接访问 http://192.168.31.43:8000
     ├─ 能看到 → MJPEG服务正常，检查代理
     └─ 不能 → MaixCAM服务有问题
     ↓
[3] 检查Web Server是否启动
     ├─ 否 → 启动Web Server
     └─ 是 → 下一步
     ↓
[4] 访问 http://localhost:3000/maixcam_stream
     ├─ 能看到 → 代理正常，检查前端代码
     └─ 不能 → 检查代理路由配置
```

---

## 📌 总结

**本文档包含：**
- ✅ 完整的系统架构设计
- ✅ 详细的分阶段实施计划
- ✅ 可能存在的问题及解决方案
- ✅ 技术原理深入讲解
- ✅ 验收标准和FAQ

**下一步行动：**
1. 🔍 仔细阅读本文档，理解系统架构
2. ✅ 确认设备准备就绪（MaixCAM已联网）
3. 📝 准备好文本编辑器和命令行工具
4. 🚀 等待"开始写代码"指令

---

**文档结束**
如有疑问，请随时询问！
